<form class="jot-area-form">
  <div class="jot-editor" data-editor-wrapper id="{{ wid }}">
    <div class="jot-toolbar">
      
      {% macro jotButton(name, label) %}
        {% if controlMap[name] %}
          <a class="jot-control jot-button jot-{{ name }}-button" data-{{ name }}>{{ label }}</a>
        {% endif %}
      {% endmacro %}
      
      {% macro jotMenu(name, label, options) %}
        {% if controlMap[name] %}
          <div class="jot-control jot-menu={{ name }} jot-menu">
            <div class="jot-menu-label">{{ label }}</div>
            <select class="jot-menu-select" data-{{ name }}>
              {% for optionValue, optionLabel in options %}
                <option value="{{ optionValue | e }}">{{ optionLabel }}</option>
              {% endfor %} 
            </select>
          </div>
        {% endif %}
      {% endmacro %}

      {# TODO: should be configurable, although browsers have inherent limits here #}
      {{ jotMenu('style', 'Style', { 
        'div': 'Normal',
        'h3': 'Heading 3',
        'h4': 'Heading 4',
        'h5': 'Heading 5',
        'h6': 'Heading 6'
      }) }}

      {{ jotButton('bold', 'b') }}
      {{ jotButton('italic', 'i') }}
      {{ jotButton('createLink', 'Link') }}

      {% macro jotWidgetButton(name, label) %}
        {% if controlMap[name] %}
          <a class="jot-control jot-button jot-{{ name }}-button" data-widgetButton="{{ name | capitalize }}">{{ label }}</a>
        {% endif %}
      {% endmacro %}
      
      {{ jotWidgetButton('image', 'Image') }}
      {{ jotWidgetButton('video', 'Video') }}
      {{ jotWidgetButton('pullquote', '&ldquo;&rdquo;') }}
      {{ jotWidgetButton('code', 'i++') }}

      <div class="jot-clear"></div>
    </div>
    <div class="jot-editable" data-editable contentEditable="true">&nbsp;</div>
  </div>
  <div class="jot-area-form-footer">
    <a class="jot-control jot-button jot-save" data-save-area>Save</a>
    <a class="jot-control jot-button jot-cancel" data-cancel-area>Cancel</a>
  </div>
  <div class="jot-clear"></div>
</form>

<script>
  $(function() {
    // I have seen jquery domready fail to see this id yet, so
    // wait for "next tick" as well (Chrome)
    setTimeout(function() {
      var editor = new jot.Editor({ selector: '#{{ wid }}', data: {{ content | json }} });
      $(function() {
        $('#{{ wid }} [data-editable]').focus();
        $('#{{ wid }}').data('jot-editor', editor);
      });
    }, 0);
  });
</script>

